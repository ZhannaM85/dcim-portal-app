<div class="server-detail" *ngIf="server">
    <div class="server-detail__top-bar">
        <kit-button
            [label]="'SERVER_DETAIL.BACK' | translate"
            variant="secondary"
            size="small"
            (buttonClicked)="goBack()">
        </kit-button>

        <div class="server-detail__actions">
            <kit-button
                *ngIf="!isEditMode"
                [label]="'COMMON.EDIT' | translate"
                variant="primary"
                size="small"
                (buttonClicked)="toggleEditMode()">
            </kit-button>

            <kit-button
                *ngIf="!isEditMode"
                [label]="'SERVER_DETAIL.RESTART' | translate"
                variant="secondary"
                size="small"
                (buttonClicked)="onRestart()">
            </kit-button>

            <kit-button
                *ngIf="!isEditMode"
                [label]="'SERVER_DETAIL.SHUT_DOWN' | translate"
                variant="danger"
                size="small"
                (buttonClicked)="onShutDown()">
            </kit-button>

            <kit-button
                *ngIf="isEditMode"
                [label]="'COMMON.CANCEL' | translate"
                variant="secondary"
                size="small"
                (buttonClicked)="cancelEdit()">
            </kit-button>

            <kit-button
                *ngIf="isEditMode"
                [label]="'COMMON.SAVE' | translate"
                variant="primary"
                size="small"
                (buttonClicked)="saveChanges()"
                [disabled]="serverForm.invalid">
            </kit-button>
        </div>
    </div>

    <div class="server-detail__header">
        <h1 class="server-detail__hostname">{{ server.hostname }}</h1>
        <span class="status-badge"
              [ngClass]="'status-badge--' + server.status">
            {{ server.status }}
        </span>
    </div>
    <p class="server-detail__id">{{ server.id }}</p>

    <!-- View Mode -->
    <div class="server-detail__cards" *ngIf="!isEditMode">
        <div class="info-card">
            <h3 class="info-card__title">{{ 'SERVER_DETAIL.SECTION.NETWORK' | translate }}</h3>
            <div class="info-card__rows">
                <div class="info-card__row">
                    <span class="info-card__label">{{ 'COMMON.IP_ADDRESS' | translate }}</span>
                    <span class="info-card__value mono">{{ server.ipAddress }}</span>
                </div>
                <div class="info-card__row">
                    <span class="info-card__label">{{ 'COMMON.LOCATION' | translate }}</span>
                    <span class="info-card__value">{{ server.location }}</span>
                </div>
            </div>
        </div>

        <div class="info-card">
            <h3 class="info-card__title">{{ 'SERVER_DETAIL.SECTION.SYSTEM' | translate }}</h3>
            <div class="info-card__rows">
                <div class="info-card__row">
                    <span class="info-card__label">{{ 'COMMON.OPERATING_SYSTEM' | translate }}</span>
                    <span class="info-card__value">{{ server.os }}</span>
                </div>
                <div class="info-card__row">
                    <span class="info-card__label">{{ 'COMMON.UPTIME' | translate }}</span>
                    <span class="info-card__value">{{ formatUptime(server.uptimeHours) }}</span>
                </div>
            </div>
        </div>

        <div class="info-card">
            <h3 class="info-card__title">{{ 'SERVER_DETAIL.SECTION.HARDWARE' | translate }}</h3>
            <div class="info-card__rows">
                <div class="info-card__row">
                    <span class="info-card__label">{{ 'COMMON.CPU_CORES' | translate }}</span>
                    <span class="info-card__value">{{ server.cpuCores }}</span>
                </div>
                <div class="info-card__row">
                    <span class="info-card__label">{{ 'COMMON.RAM' | translate }}</span>
                    <span class="info-card__value">{{ server.ramGb }} {{ 'COMMON.GB' | translate }}</span>
                </div>
                <div class="info-card__row">
                    <span class="info-card__label">{{ 'COMMON.STORAGE' | translate }}</span>
                    <span class="info-card__value">{{ server.storageGb }} {{ 'COMMON.GB' | translate }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- CPU Usage Chart -->
    <app-server-detail-chart
        *ngIf="!isEditMode"
        [serverId]="server.id"
        [uptimeHours]="server.uptimeHours || 0">
    </app-server-detail-chart>

    <!-- Edit Mode -->
    <form [formGroup]="serverForm" *ngIf="isEditMode" class="server-detail__edit-form">
        <div class="server-detail__edit-section">
            <h3 class="server-detail__edit-title">{{ 'SERVER_DETAIL.SECTION.NETWORK' | translate }}</h3>
            <div class="server-detail__edit-fields">
                <kit-input
                    [label]="'COMMON.HOSTNAME' | translate"
                    formControlName="hostname"
                    [placeholder]="'SERVER_DETAIL.PLACEHOLDER.HOSTNAME' | translate"
                    [required]="true"
                    [error]="serverForm.get('hostname')?.touched && serverForm.get('hostname')?.invalid ? getErrorMessage('hostname') : ''">
                </kit-input>

                <kit-input
                    [label]="'COMMON.IP_ADDRESS' | translate"
                    formControlName="ipAddress"
                    type="text"
                    [placeholder]="'SERVER_DETAIL.PLACEHOLDER.IP_ADDRESS' | translate"
                    [required]="true"
                    [error]="serverForm.get('ipAddress')?.touched && serverForm.get('ipAddress')?.invalid ? getErrorMessage('ipAddress') : ''">
                </kit-input>

                <div class="server-detail__edit-field" role="group" aria-labelledby="location-label">
                    <span id="location-label" class="form-label">
                        {{ 'COMMON.LOCATION' | translate }} <span class="form-label__required">*</span>
                    </span>
                    <kit-dropdown
                        [options]="locationOptions"
                        [placeholder]="'SERVER_DETAIL.PLACEHOLDER.SELECT_LOCATION' | translate"
                        [selectedValue]="serverForm.get('location')?.value"
                        (selectionChange)="serverForm.get('location')?.setValue($event)">
                    </kit-dropdown>
                    <span *ngIf="serverForm.get('location')?.touched && serverForm.get('location')?.invalid" class="form-error">
                        {{ getErrorMessage('location') }}
                    </span>
                </div>
            </div>
        </div>

        <div class="server-detail__edit-section">
            <h3 class="server-detail__edit-title">{{ 'SERVER_DETAIL.SECTION.SYSTEM' | translate }}</h3>
            <div class="server-detail__edit-fields">
                <kit-input
                    [label]="'COMMON.OPERATING_SYSTEM' | translate"
                    formControlName="os"
                    [placeholder]="'SERVER_DETAIL.PLACEHOLDER.OS' | translate"
                    [required]="true"
                    [error]="serverForm.get('os')?.touched && serverForm.get('os')?.invalid ? getErrorMessage('os') : ''">
                </kit-input>
            </div>
        </div>

        <div class="server-detail__edit-section">
            <h3 class="server-detail__edit-title">{{ 'SERVER_DETAIL.SECTION.HARDWARE' | translate }}</h3>
            <div class="server-detail__edit-fields server-detail__edit-fields--inline">
                <kit-input
                    [label]="'COMMON.CPU_CORES' | translate"
                    formControlName="cpuCores"
                    type="number"
                    [placeholder]="'SERVER_DETAIL.PLACEHOLDER.CPU_CORES' | translate"
                    [required]="true"
                    [error]="serverForm.get('cpuCores')?.touched && serverForm.get('cpuCores')?.invalid ? getErrorMessage('cpuCores') : ''">
                </kit-input>

                <kit-input
                    [label]="'COMMON.RAM_GB' | translate"
                    formControlName="ramGb"
                    type="number"
                    [placeholder]="'SERVER_DETAIL.PLACEHOLDER.RAM' | translate"
                    [required]="true"
                    [error]="serverForm.get('ramGb')?.touched && serverForm.get('ramGb')?.invalid ? getErrorMessage('ramGb') : ''">
                </kit-input>

                <kit-input
                    [label]="'COMMON.STORAGE_GB' | translate"
                    formControlName="storageGb"
                    type="number"
                    [placeholder]="'SERVER_DETAIL.PLACEHOLDER.STORAGE' | translate"
                    [required]="true"
                    [error]="serverForm.get('storageGb')?.touched && serverForm.get('storageGb')?.invalid ? getErrorMessage('storageGb') : ''">
                </kit-input>
            </div>
        </div>
    </form>
</div>
