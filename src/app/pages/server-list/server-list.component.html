<div class="server-list">
    <div class="server-list__header">
        <h1 class="server-list__title">Servers</h1>
        <span class="server-list__count">{{ filteredServers.length }} of {{ servers.length }} servers</span>
    </div>

    <div class="server-list__toolbar">
        <div class="server-list__filters">
            <kit-dropdown
                [options]="statusOptions"
                placeholder="All Statuses"
                [selectedValue]="selectedStatus"
                (selectionChange)="onStatusFilterChange($event)">
            </kit-dropdown>

            <kit-dropdown
                [options]="locationOptions"
                placeholder="All Locations"
                [selectedValue]="selectedLocation"
                (selectionChange)="onLocationFilterChange($event)">
            </kit-dropdown>
        </div>

        <div class="server-list__actions">
            <kit-button
                label="Add Server"
                variant="primary"
                size="small"
                (buttonClicked)="onAddServer()">
            </kit-button>

            <kit-button
                label="Restart Selected"
                variant="secondary"
                size="small"
                [disabled]="!hasSelection"
                (buttonClicked)="onRestartSelected()">
            </kit-button>

            <kit-button
                label="Delete Selected"
                variant="danger"
                size="small"
                [disabled]="!hasSelection"
                (buttonClicked)="onDeleteSelected()">
            </kit-button>
        </div>
    </div>

    <div class="server-list__table-wrapper">
        <table class="server-list__table">
            <thead>
                <tr>
                    <th class="col-select">
                        <kit-checkbox
                            [checked]="allSelected"
                            [indeterminate]="someSelected"
                            (checkedChange)="toggleSelectAll($event)">
                        </kit-checkbox>
                    </th>
                    <th class="sortable" (click)="sort('hostname')">
                        Hostname
                        <kit-icon-sort-asc *ngIf="sortColumn === 'hostname' && sortDirection === 'asc'"></kit-icon-sort-asc>
                        <kit-icon-sort-desc *ngIf="sortColumn === 'hostname' && sortDirection === 'desc'"></kit-icon-sort-desc>
                    </th>
                    <th class="sortable" (click)="sort('ipAddress')">
                        IP Address
                        <kit-icon-sort-asc *ngIf="sortColumn === 'ipAddress' && sortDirection === 'asc'"></kit-icon-sort-asc>
                        <kit-icon-sort-desc *ngIf="sortColumn === 'ipAddress' && sortDirection === 'desc'"></kit-icon-sort-desc>
                    </th>
                    <th class="sortable" (click)="sort('status')">
                        Status
                        <kit-icon-sort-asc *ngIf="sortColumn === 'status' && sortDirection === 'asc'"></kit-icon-sort-asc>
                        <kit-icon-sort-desc *ngIf="sortColumn === 'status' && sortDirection === 'desc'"></kit-icon-sort-desc>
                    </th>
                    <th class="sortable" (click)="sort('location')">
                        Location
                        <kit-icon-sort-asc *ngIf="sortColumn === 'location' && sortDirection === 'asc'"></kit-icon-sort-asc>
                        <kit-icon-sort-desc *ngIf="sortColumn === 'location' && sortDirection === 'desc'"></kit-icon-sort-desc>
                    </th>
                    <th class="sortable" (click)="sort('os')">
                        OS
                        <kit-icon-sort-asc *ngIf="sortColumn === 'os' && sortDirection === 'asc'"></kit-icon-sort-asc>
                        <kit-icon-sort-desc *ngIf="sortColumn === 'os' && sortDirection === 'desc'"></kit-icon-sort-desc>
                    </th>
                    <th class="sortable" (click)="sort('cpuCores')">
                        CPU
                        <kit-icon-sort-asc *ngIf="sortColumn === 'cpuCores' && sortDirection === 'asc'"></kit-icon-sort-asc>
                        <kit-icon-sort-desc *ngIf="sortColumn === 'cpuCores' && sortDirection === 'desc'"></kit-icon-sort-desc>
                    </th>
                    <th class="sortable" (click)="sort('ramGb')">
                        RAM
                        <kit-icon-sort-asc *ngIf="sortColumn === 'ramGb' && sortDirection === 'asc'"></kit-icon-sort-asc>
                        <kit-icon-sort-desc *ngIf="sortColumn === 'ramGb' && sortDirection === 'desc'"></kit-icon-sort-desc>
                    </th>
                    <th class="sortable" (click)="sort('storageGb')">
                        Storage
                        <kit-icon-sort-asc *ngIf="sortColumn === 'storageGb' && sortDirection === 'asc'"></kit-icon-sort-asc>
                        <kit-icon-sort-desc *ngIf="sortColumn === 'storageGb' && sortDirection === 'desc'"></kit-icon-sort-desc>
                    </th>
                    <th class="sortable" (click)="sort('uptimeHours')">
                        Uptime
                        <kit-icon-sort-asc *ngIf="sortColumn === 'uptimeHours' && sortDirection === 'asc'"></kit-icon-sort-asc>
                        <kit-icon-sort-desc *ngIf="sortColumn === 'uptimeHours' && sortDirection === 'desc'"></kit-icon-sort-desc>
                    </th>
                    <th class="col-action"></th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let server of filteredServers"
                    [class.selected]="isSelected(server.id)">
                    <td class="col-select">
                        <kit-checkbox
                            [checked]="isSelected(server.id)"
                            (checkedChange)="toggleServerSelection(server.id, $event)">
                        </kit-checkbox>
                    </td>
                    <td>
                        <a class="server-list__hostname"
                           [routerLink]="['/servers', server.id]">
                            {{ server.hostname }}
                        </a>
                    </td>
                    <td class="mono">{{ server.ipAddress }}</td>
                    <td>
                        <span class="status-badge"
                              [ngClass]="'status-badge--' + server.status">
                            {{ server.status }}
                        </span>
                    </td>
                    <td>{{ server.location }}</td>
                    <td>{{ server.os }}</td>
                    <td>{{ server.cpuCores }} cores</td>
                    <td>{{ server.ramGb }} GB</td>
                    <td>{{ server.storageGb }} GB</td>
                    <td>{{ formatUptime(server.uptimeHours) }}</td>
                    <td class="col-action">
                        <kit-button
                            label="View"
                            variant="secondary"
                            size="small"
                            (buttonClicked)="navigateToDetail(server.id)">
                        </kit-button>
                    </td>
                </tr>
                <tr *ngIf="filteredServers.length === 0">
                    <td colspan="11" class="server-list__empty">
                        No servers match the current filters.
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
